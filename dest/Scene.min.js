!function(){function camelize(str){return str.replace(/(?:^\w|[A-Z]|\b\w)/g,function(letter,index){return 0==index?letter.toLowerCase():letter.toUpperCase()}).replace(/\s+/g,"")}function replaceAll(text,from,to){return text?text.split(from).join(to):""}!function(){var StringPrototype=String.prototype;StringPrototype.replaceAll=function(from,to){return this?this.split(from).join(to):""}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();var defineGetter=function(object,name,target){object[camelize("get "+name)]=function(name){return function(obj){return target?this[target][obj]:this[name]}}(name)},defineSetter=function(object,name,target){object[camelize("set "+name)]=function(name){return function(v1,v2){return target?this[target][v1]=v2:this[name]=v1,this}}(name)},defineRemover=function(object,name,target){object[camelize("remove "+name)]=function(name){return function(v1){return delete this[target][v1],this}}(name)},defineGetterSetter=function(object,name,target){defineGetter(object,name,target),defineSetter(object,name,target)},defineAll=function(object,name,target){defineGetter(object,name,target),defineSetter(object,name,target),defineRemover(object,name,target)},addFunction=function(func,func2){return function(){return function(){func.apply(this,arguments),func2.apply(this,arguments)}}()},Scene=window.Scene=function(items){this.sceneItems={},this._startTime=this._prevTime=this._nowTime=0,this._isStart=this._isFinish=this._isPause=!1,this.playSpeed=1,this.playCount=0,this.iterationCount=1,this.direction="normal",this.delay=0,this.name="",this.callbackFunction={},items&&this.load(items)};Scene._roles=[];Scene.addRole=function(name,plural){var _roles=Scene._roles;_roles.push({name:name,plural:plural,capitalize:camelize(" "+name)}),SceneItem.addGetFramePropertyFunction(name),SceneItem.addPropertyFunction(name,plural),Frame.addPropertyFunction(name,plural)};var scenePrototype=Scene.prototype;defineGetterSetter(scenePrototype,"name"),defineGetterSetter(scenePrototype,"playSpeed"),defineGetterSetter(scenePrototype,"playCount"),defineGetterSetter(scenePrototype,"iterationCount"),defineGetterSetter(scenePrototype,"direction"),scenePrototype.load=function(items){if(!items)return this;var itemName,sceneItem,item;for(itemName in items)"option"!==itemName&&(item=items[itemName],sceneItem=this.newItem(itemName),sceneItem.load(item));if("option"in items){var options=items.option;for(option in options)if(value=options[option],"timingFunction"===option)for(var i=0;i<value.length/3;++i)this.addTimingFunction(value[3*i+0],value[3*i+1],value[3*i+2]);else this[option]=options[option]}return this},scenePrototype.newItem=function(id){var item=new SceneItem;return this.addItem(id,item)},scenePrototype.addItem=function(id,sceneItem){return sceneItem.setId(id),this.sceneItems[id]?this.sceneItems[id]:(this.sceneItems[id]=sceneItem,sceneItem)},scenePrototype.getFinishTime=function(){var item,id,_time,sceneItems=this.sceneItems,time=0;for(id in sceneItems)item=sceneItems[id],_time=item.getFinishTime(),time<_time&&(time=_time);return time},scenePrototype.getItem=function(id){var type=typeof id;try{return"string"===type?this.sceneItems[id]:this.sceneItems[id.getAttribute(ATTR_ITEM_ID)]}catch(e){}},scenePrototype.isTimeEnd=function(){var item,sceneItems=this.sceneItems,itemsLength=0,finishCount=0,direction=this.direction;for(id in sceneItems)++itemsLength,item=sceneItems[id],item.isTimeEnd(direction)&&++finishCount;return itemsLength<=finishCount},scenePrototype.setTime=function(time,isPlay){var item,id,sceneItems=this.sceneItems;for(id in sceneItems)item=sceneItems[id],item.setTime(time,isPlay);return this.trigger("animate",[time]),this},scenePrototype.trigger=function(name,args){var _callback,length;try{if(_callback=this.callbackFunction[name]){length=_callback.length;for(var i=0;i<length;++i)_callback[i].apply(this,args)}}catch(e){}},scenePrototype.on=function(name,func){return this.callbackFunction[name]=this.callbackFunction[name]||[],this.callbackFunction[name].push(func),this},scenePrototype.tick=function(resolve,reject){var self=this,finishTime=this.getFinishTime();if(self._isStart){self._nowTime=Date.now();var duration=(self._nowTime-self._startTime)/1e3*self.getPlaySpeed()-this.delay;if(!(duration<0)){"reverse"===this.direction&&(duration=finishTime-duration),self.setTime(duration,!0);try{var isTimeEnd=self.isTimeEnd()}catch(e){}if(isTimeEnd){var ic=this.getIterationCount(),pc=this.getPlayCount();if(this.finish(),this.setPlayCount(++pc),this.getFinishTime()<=0);else if("infinite"===ic||pc<ic)return void this.play();this.trigger("done"),resolve&&resolve()}else requestAnimFrame(function(){self.tick(resolve,reject)})}}},scenePrototype.then=function(resolve){this.on("done",resolve)},scenePrototype.play=function(option){var self=this,func=function(resolve,reject){self._isStart||(console.log("PLAY"),self._startTime=self.prevTime=Date.now()-(option&&option.time||0),self.nowTime=this.spendTime=0,self.setPlayCount(0),self._isStart=!0,self._isFinish=!1,self._isPause=!1,self.tick(resolve,reject))};return window.Promise?new Promise(func):(func(),this)},scenePrototype.finish=function(){console.log("FINISH"),this._isStart=!1,this._isFinish=!0,this._isPause=!1,this.setPlayCount(0)},scenePrototype.stop=function(){console.log("STOP"),this._isStart=!1,this._isFinish=!1,this._isPause=!1,this.setPlayCount(0)},scenePrototype.isPlay=function(){return this._isStart},scenePrototype.isFinish=function(){return this._isFinish},scenePrototype.addTimingFunction=function(startTime,endTime,curveArray){var item,sceneItems=this.sceneItems;for(var id in sceneItems)item=sceneItems[id],item.addTimingFunction(startTime,endTime,curveArray);return this},scenePrototype.setClippingRegion=function(x,y,width,height){};var DEFAULT_FRAME_TIME=Scene.DEFAULT_FRAME_TIME=0,ATTR_ITEM_ID="item-id";Scene.EASE=[.25,.1,.25,1],Scene.EASE_IN=[.42,0,1,1],Scene.EASE_IN_OUT=[.42,0,.58,1];var SceneItem=Scene.SceneItem=function(element){var self=this;self.id="",self.element=element,self.time=0,self.times=[],self.frames={},self.names={};for(var _roles=Scene._roles,length=_roles.length,i=0;i<length;++i)self.names[_roles[i].name]=[];self.timingFunctions=[],self.nowTimingFunction,this.callbackFunction={},self.element=element,self.newFrame(DEFAULT_FRAME_TIME),this.init()},sceneItemPrototype=SceneItem.prototype;defineGetterSetter(sceneItemPrototype,"element"),defineGetterSetter(sceneItemPrototype,"id"),sceneItemPrototype.init=function(){},sceneItemPrototype.load=function(item){var time,properties,frame;for(time in item)properties=item[time],time=parseFloat(time),isNaN(time)||(frame=this.newFrame(time),frame.load(properties));if("option"in item){var option,value,options=item.option;for(option in options)if(value=options[option],"timingFunction"!==option)this[option]=options[option];else for(var i=0;i<value.length/3;++i)this.addTimingFunction(value[3*i+0],value[3*i+1],value[3*i+2])}return this},sceneItemPrototype.set=function(name,time,property,value){var frame;return"number"!=typeof time&&isNaN(parseFloat(time))?this:(frame=this.newFrame(time),frame.set(name,property,value),this)},sceneItemPrototype.sets=function(name,time,properties){var frame;return"number"!=typeof time&&isNaN(parseFloat(time))?this:(frame=this.newFrame(time),frame.sets(name,properties),this)},sceneItemPrototype.isIn=function(name,property){var frame,time,frames=this.frames;for(time in frames)if(frame=frames[time],frame&&"undefined"!=typeof frame.get(name,property))return!0;return!1},sceneItemPrototype.remove=function(name,time,property){var index=this.names[name].indexOf(property);if(index==-1)return this;var frame=this.getFrame(time);return frame?(frame.remove(name,property),this):this},sceneItemPrototype.get=function(name,time,property){var frame;if(frame=this.frames[time])return frame.get(name,property)},sceneItemPrototype.addName=function(name,propertyName){if(this.names[name].indexOf(propertyName)==-1)return this.names[name].push(propertyName),this},sceneItemPrototype.removeName=function(name,property){this.isIn(name,property)||this.names[name].splice(index,1)},SceneItem.addPropertyFunction=function(name,names){var setProperty=camelize("set "+name),getProperty=camelize("get "+name),setProperties=camelize("set "+names),removeProperty=camelize("remove "+name),addPropertyName=camelize("add "+name)+"Name",isInProperty=camelize("isIn "+name);sceneItemPrototype[addPropertyName]=function(propertyName){this.addName(name,propertyName)},sceneItemPrototype[getProperty]=function(time,property,value){return this.get(name,time,property)},sceneItemPrototype[setProperty]=function(time,property,value){return this.set(name,time,property,value),this},sceneItemPrototype[setProperties]=function(time,properties){return this.sets(name,time,properties),this},sceneItemPrototype[removeProperty]=function(time,property){return this.remove(name,time,property),this},sceneItemPrototype[isInProperty]=function(property){return this.isIn(name,property)}};var getNowFrameByProperty=function(sceneItem,time,property,prevFunc,nextFunc,func){var prevFrame=sceneItem[prevFunc](time,property),nextFrame=sceneItem[nextFunc](time,property);if(prevFrame){var prevValue=prevFrame[func](property);if("undefined"!=typeof prevValue){if(!nextFrame)return prevValue;var nextValue=nextFrame[func](property);if("undefined"==typeof nextValue)return prevValue;var value,prevTime=prevFrame.time;return prevTime<0&&(prevTime=0),value=_u.dot(prevValue,nextValue,time-prevTime,nextFrame.time-time)}}},getPrevFrameByProperty=function(sceneItem,time,property,func){var frame,value;if((frame=sceneItem.getFrame(time))&&(value=frame[func](property)))return frame;for(var times=sceneItem.times,i=(times.length,times.length-1);i>=0;--i)if(!(times[i]>time)&&(frame=sceneItem.getFrame(times[i]),"undefined"!=typeof frame[func](property)))return frame;if(sceneItem.element){sceneItem.element;return sceneItem.getFrame(DEFAULT_FRAME_TIME)}},getNextFrameByProperty=function(sceneItem,time,property,func){var frame,value;if((frame=sceneItem.getFrame(time))&&(value=frame[func](property)))return frame;for(var times=sceneItem.times,length=times.length,i=0;i<length;++i)if(!(times[i]<time)&&(frame=sceneItem.getFrame(times[i]),"undefined"!=typeof frame[func](property)))return frame};SceneItem.addGetFramePropertyFunction=function(name){var Property=camelize(" "+name);sceneItemPrototype["getNowFrameBy"+Property]=function(time,property){return getNowFrameByProperty(this,time,property,"getPrevFrameBy"+Property,"getNextFrameBy"+Property,"get"+Property)},sceneItemPrototype["getPrevFrameBy"+Property]=function(time,property){return getPrevFrameByProperty(this,time,property,"get"+Property)},sceneItemPrototype["getNextFrameBy"+Property]=function(time,property){return getNextFrameByProperty(this,time,property,"get"+Property)}},sceneItemPrototype.getTimeIndex=function(time){return this.times.indexOf(time)},sceneItemPrototype.getNowFrame=function(time){for(var vNames,value,property,capital,self=this,frame=(self.times,new Frame(self,time)),_roles=Scene._roles,length=_roles.length,i=0;i<length;++i){capital=_roles[i].capitalize,vNames=self.names[_roles[i].name];for(var nameLength=vNames.length,j=0;j<nameLength;++j)property=vNames[j],value=self["getNowFrameBy"+capital](time,property),frame["set"+capital](property,value)}return frame},sceneItemPrototype.isTimeEnd=function(direction){return"reverse"==direction?0==this.time:this.getFinishTime()<=this.time},sceneItemPrototype.getFinishTime=function(){return this.times.length>0?this.times[this.times.length-1]:0},sceneItemPrototype.trigger=function(name,args){var _callback,length;try{if(_callback=this.callbackFunction[name]){length=_callback.length;for(var i=0;i<length;++i)_callback[i].apply(this,args)}}catch(e){}},sceneItemPrototype.on=function(name,func){return this.callbackFunction[name]=this.callbackFunction[name]||[],this.callbackFunction[name].push(func),this},sceneItemPrototype.setTime=function(time,isPlay){if(this.getFinishTime()<time?time=this.getFinishTime():time<0&&(time=0),this.time==time&&time>0&&isPlay)return this;this.time=time;var timingFunctions=this.timingFunctions,length=timingFunctions.length,nowTimingFunction=this.nowTimingFunction;if(nowTimingFunction&&(nowTimingFunction.endTime<time||time<nowTimingFunction.startTime)||length>0&&!nowTimingFunction){nowTimingFunction=this.nowTimingFunction=0;for(var i=0;i<length;++i)if(timingFunctions[i].startTime<=time&&time<=timingFunctions[i].endTime){nowTimingFunction=this.nowTimingFunction=timingFunctions[i];break}}try{nowTimingFunction&&(time=nowTimingFunction&&nowTimingFunction.cubicBezier(time)||time)}catch(e){}return frame=this.getNowFrame(time),this.trigger("animate",[time,frame]),this},sceneItemPrototype.addFrame=function(time,frame){time=parseFloat(time);var _frame=this.getFrame(time);if(_frame)return _frame.merge(frame),this;frame.setSceneItem(this);for(var times=this.times,length=times.length,pushIndex=0,i=0;i<length;++i)if(pushIndex=i+1,times[i]>time){pushIndex=i;break}return this.times.splice(pushIndex,0,time),this.frames[time]=frame,frame.time=time,this},sceneItemPrototype.newFrame=function(time){var frame=this.getFrame(time);return frame?frame:(frame=new Frame(this,time),this.addFrame(time,frame),frame)},sceneItemPrototype.setFrame=function(time,frame){return frame.time=time,this.getFrame(time)?this.frames[time]=frame:this.addFrame(time,frame),this},sceneItemPrototype.getFrame=function(time){return this.frames[time]},sceneItemPrototype.removeFrame=function(time){this.frames[time].setSceneItem(null);var index=this.getTimeIndex(time);return index<0?this:(this.times.splice(index,1),delete this.frames[time],this)},sceneItemPrototype.copyFrame=function(fromTime,toTime){var frame=this.getFrame(fromTime),copyFrame=frame.copy();return this.setFrame(toTime,copyFrame),this},sceneItemPrototype.addTimingFunction=function(startTime,endTime,curveArray){for(var timingFunctions=this.timingFunctions,length=timingFunctions.length,pushIndex=0,i=0;i<length;++i)if(pushIndex=i+1,timingFunctions[i].startTime>startTime){pushIndex=i;break}var timingFunction=new TimingFunction(startTime,endTime,curveArray);this.timingFunctions.splice(pushIndex,0,timingFunction)};var Frame=Scene.Frame=function(sceneItem,time){this.sceneItem=sceneItem,this.properties={},this.time=time;for(var _roles=Scene._roles,length=_roles.length,i=0;i<length;++i)this.properties[_roles[i].name]={}},framePrototype=Frame.prototype;defineAll(framePrototype,"sceneItem"),framePrototype.load=function(properties){var property,p2,value,self=this,_util=Scene.Util;for(property in properties)if(value=properties[property],property in this.properties)if("object"==typeof value)for(p2 in value)this.set(property,p2,value[p2]);else{if(value=_util.stringToObject(value),"object"!=typeof value)continue;if("array"!==value.type){this.set(property,value.model,value.value.join(value.separator));continue}value.each(function(v,i){"object"==typeof value&&self.set(property,v.model,v.value.join(v.separator))})}else this.set("property",property,value);return this},framePrototype.set=function(name,property,value){if(!this.properties[name])return this;"string"==typeof value&&(value=_u.stringToObject(value)),this.properties[name][property]=value;var sceneItem=this.getSceneItem();return sceneItem&&sceneItem.addName(name,property),this},framePrototype.sets=function(name,properties){for(var property in properties)this.set(name,property,properties[property]);return this},framePrototype.remove=function(name,property){if(!this.properties[name])return this;delete this.properties[name][property];var sceneItem=this.getSceneItem();return sceneItem&&sceneItem.removeName(name,property),this},framePrototype.get=function(name,property){if(this.properties[name])return this.properties[name][property]},Frame.addPropertyFunction=function(name,names){var setProperty=camelize("set "+name),getProperty=camelize("get "+name),setProperties=camelize("set "+names),removeProperty=camelize("remove "+name);framePrototype[getProperty]=function(property){return this.get(name,property)},framePrototype[setProperty]=function(property,value){return this.set(name,property,value),this},framePrototype[setProperties]=function(properties){return this.sets(name,properties),this},framePrototype[removeProperty]=addFunction(framePrototype.removeProperty,function(property){return this.remove(name,property),this})},framePrototype.copy=function(){var frame=new Frame(this.sceneItem,this.time);return frame.merge(this),frame},framePrototype.merge=function(frame){for(var properties,_frame=this,_roles=Scene._roles,length=_roles.length,i=0;i<length;++i)properties=frame.properties[_roles[i].name],_frame.sets(_roles[i].name,properties)};var Curve={_bezier:function(x1,y1,x2,y2){function cubic(_x1,_x2,t){var t2=1-t;return t*t*t+3*t*t*t2*_x2+3*t*t2*t2*_x1}function solveFromX(x){for(var t=x,_x=x,dx=1;Math.abs(dx)>.001;){if(_x=cubic(x1,x2,t),dx=_x-x,Math.abs(dx)<.001)return t;t-=dx/2}return t}return function(x){x>=1?x=1:x<=0&&(x=0);var _x=solveFromX(x);return cubic(y1,y2,_x)}},cubicBezier:function(x1,y1,x2,y2){return this._bezier(x1,y1,x2,y2)}},TimingFunction=function(_startTime,_endTime,_curveArray){this.startTime=_startTime,this.endTime=_endTime,this._bezierCurve=Curve.cubicBezier(_curveArray[0],_curveArray[1],_curveArray[2],_curveArray[3])},timingFunctionPrototype=TimingFunction.prototype;timingFunctionPrototype.cubicBezier=function(time){var startTime=this.startTime,endTime=this.endTime,dist=endTime-startTime;if(dist<=0||time<startTime||time>endTime)return time;var duration=time-startTime,_time=duration/dist;return startTime+dist*this._bezierCurve(_time)};var PropertyObject=Scene.PropertyObject=function(value,options){if(this.prefix="",this.suffix="",this.model="",this.type="","object"==typeof options)for(var key in options)this[key]=options[key];else this.separator=options;this.separator="undefined"==typeof this.separator?",":this.separator,this.value=value instanceof Object?value:value.split(this.separator)},propertyObjectPrototype=PropertyObject.prototype;defineGetterSetter(propertyObjectPrototype,"type"),defineGetterSetter(propertyObjectPrototype,"model"),defineGetterSetter(propertyObjectPrototype,"prefix"),defineGetterSetter(propertyObjectPrototype,"suffix"),propertyObjectPrototype.join=function(){var rv="",v="",s=!1,arr=this.value,separator=this.separator;for(var i in arr)s&&(rv+=separator),v=arr[i],rv+=v instanceof PropertyObject?v.toValue():v,s=!0;return rv},propertyObjectPrototype.each=function(func){var arr=this.value;for(var i in arr)func(arr[i],i,arr)},propertyObjectPrototype.toValue=function(){return this.prefix+this.join()+this.suffix},function(){var sp=SceneItem.prototype,properties=["opacity","width","height","left","top"];l=properties.length;for(var i=0;i<l;++i){var property=properties[i];sp[property]=function(property){return function(time,value){return this.setProperty(time,property,value)}}(property)}var transformProperties=["scale","translate","rotate","skew","translateX","translateY"];l=transformProperties.length;for(var i=0;i<l;++i){var property=transformProperties[i];sp[property]=function(property){return function(time,value){return this.setTransform(time,property,value)}}(property)}}();var _u=Scene.Util={splitUnit:function(v){v+="";var value=v.replace(/[^0-9|\.|\-|e\-|e\+]/g,"");value=parseFloat(value);var unit=v.replace(value,"")||"";return{unit:unit,value:value}},arrayToColorObject:function(arr){var model="rgba";if(arr instanceof PropertyObject)return arr.setType("color"),arr.setModel(model),arr.setPrefix(model+"("),arr;3===arr.length&&(arr[3]=1);var object=new PropertyObject(arr,",");return object.setType("color"),object.setModel(model),object.setPrefix(model+"("),object.setSuffix(")"),object},toColorObject:function(v){var colorArray,length,colorObject;if(v instanceof PropertyObject){colorObject=v,colorArray=colorObject.value;var length=colorArray.length}else{if("#"===v.charAt(0))return colorArray=4===v.length?_color.hexToRGB(_color.hex4to6(v)):7===v.length?_color.hexToRGB(v):_color.hexToRGB(v),this.arrayToColorObject(colorArray);if(v.indexOf("(")===-1)return this.arrayToColorObject(colorArray);colorObject=this.toBracketObject(v),colorArray=colorObject.value;var length=colorArray.length}4===length?colorArray[3]=parseFloat(colorArray[3]):3===length&&(colorArray[3]=1),colorObject.setType("color");var colorModel=colorObject.getModel().toLowerCase();switch(colorModel){case"rgb":this.arrayToColorObject(colorObject);case"rgba":for(var i=0;i<3;++i)colorArray[i]=parseInt(colorArray[i]);break;case"hsl":case"hsla":for(var i=1;i<3;++i)colorArray[i].indexOf("%")!==-1&&(colorArray[i]=parseFloat(colorArray[i])/100);return colorArray=_color.hslToRGB(colorArray),this.arrayToColorObject(colorArray)}return colorObject},toBracketObject:function(a1){var _a1=a1.split("("),model=_a1[0];_a1=a1,_a1=_a1.replace(model+"(","").split(")");var length=_a1.length;if(length<2)return a1;for(var suffix,_value,arrValue,prefix=model+"(",value="",arr=[],index=0,i=0;i<length-2;++i)value+=_a1[i]+")";for(value+=_a1[length-2],suffix=")"+_a1[length-1],value=value.split(/\s*\,\s*|(\S*\([\s\S]*\))/g),length=value.length,i=0;i<length;++i)_value=value[i],"undefined"!=typeof _value?""!==_value&&(arrValue=arr[index],arr[index]=arrValue?arrValue+_value:_value):++index;for(length=arr.length,i=0;i<length;++i)arr[i]=this.stringToObject(arr[i]);var object=new PropertyObject(arr,{separator:",",model:model,prefix:prefix,suffix:suffix});return object},dotColor:function(a1,a2,b1,b2){a1 instanceof PropertyObject||(a1=this.toColorObject(a1)),a2 instanceof PropertyObject||(a2=this.toColorObject(a2));var a1v=a1.value,a2v=a2.value,a1m=a1.model,a2m=a2.model;if(a1m!==a2m)return this.dot(a1.toValue(),a2.toValue(),b1,b2);3===a1v.length&&(a1v[3]=1),3===a2v.length&&(a2v[3]=1);for(var v=this.dotArray(a1v,a2v,b1,b2),colorModel=a1.getModel(),i=0;i<3;++i)v[i]=parseInt(v[i]);var object=new PropertyObject(v,",");return object.setType("color"),object.setModel(colorModel),object.setPrefix(a1.getPrefix()),object.setSuffix(")"),object},dotArray:function(a1,a2,b1,b2){var v1,obj={};for(var n in a1)v1=a1[n],!n in a2?obj[n]=v1:obj[n]=this.dot(v1,a2[n],b1,b2);return obj},dotObject:function(a1,a2,b1,b2){var a1type=a1.getType();if("color"===a1type)return this.dotColor(a1,a2,b1,b2);var _a1=a1.value,_a2=a2.value;try{var a2type=a2.getType()}catch(e){return a1}"array"===a1type&&"array"!==a2type?_a2={0:a2}:"array"!==a1type&&"array"===a2type&&(_a1={0:a1});var obj=this.dotArray(_a1,_a2,b1,b2),object=new PropertyObject(obj,a1.separator);return object.setPrefix(a1.getPrefix()),object.setSuffix(a1.getSuffix()),object},stringToObject:function(a1){if("string"!=typeof a1)return a1;var result,length,arr=a1.match(/(\S*\(((\([^\)]*\)|[^\)\(]*)*)\)|(\S+(\s*,\s*))|\S+)+/g);if(arr&&1!=arr.length){length=arr.length;for(var i=0;i<length;++i)arr[i]=this.stringToObject(arr[i]);return result=new PropertyObject(arr," "),result.setType("array"),result}if(a1.indexOf("(")!=-1){try{if((a1=this.toBracketObject(a1))&&_color.models.indexOf(a1.getModel().toLowerCase())!=-1)return this.toColorObject(a1)}catch(e){throw new Error("Error : This is an invalid format."+a1)}arr=a1.value,length=arr.length;for(var i=0;i<length;++i)arr[i]=this.stringToObject(arr[i])}else{if(a1.indexOf(",")!=-1)return result=new PropertyObject(a1,","),result.setType("array"),result;if(0===a1.indexOf("#"))return this.toColorObject(a1)}return a1},dot:function(a1,a2,b1,b2){if(a1 instanceof PropertyObject)return this.dotObject(a1,a2,b1,b2);if(b1+b2==0)return a1;var v,v1=this.splitUnit(a1),v2=this.splitUnit(a2),r1=b1/(b1+b2),r2=1-r1;if(isNaN(v1.value)||isNaN(v2.value))return r1>=1?a2:a1;v=v1.value*r2+v2.value*r1;var unit=v1.unit||v2.unit||!1;return unit===!1?v:v+unit.trim()},addFunction:function(target,name,func,opt){if(isInFunc=!!target[name],!isInFunc)return void(target[name]=func);var newfunc=function(_func,func,chkfunc,_isRV,isRV){return function(){var _rv,rv,args=arguments;return _rv=_func.apply(this,args),(chkfunc&&chkfunc(_rv)||!chkfunc)&&(rv=func.apply(this,args)),_isRV?_rv:rv}},_func=target[name],chkfunc=opt.checkFunction,isRV=opt.isReturnValue;opt.isPrefix?target[name]=newfunc(func,_func,chkfunc,isRV,!isRV):target[name]=newfunc(_func,func,chkfunc,!isRV,isRV)}},_color=Scene.Color={models:["rgb","rgba","hsl","hsla"],nameToRGB:function(name){var rgb=this.rgbCodes[name];rgb||(rgb=this.rgbCodes.black);for(var arr=rgb.split(","),i=0;i<3;++i)arr[i]=parseInt(arr[i]);return arr},hexToRGB:function(h){h=this.cutHex(h);var r=parseInt(h.substring(0,2),16),g=parseInt(h.substring(2,4),16),b=parseInt(h.substring(4,6),16);return[r,g,b]},cutHex:function(h){return"#"===h.charAt(0)?h.substring(1,7):h},hex4to6:function(h){var r=h.charAt(1),g=h.charAt(2),b=h.charAt(3),arr=[r,r,g,g,b,b];return arr.join("")},rgbToHSL:function(rgb){var h,s,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2,d=max-min;if(0===d)h=s=0;else switch(s=d/(1-Math.abs(2*l-1)),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}var result=[60*h,s,l];return rgb.length>3&&(result[3]=rgb[3]),result},hslToRGB:function(hsl){var h=hsl[0],s=hsl[1],l=hsl[2];h<0&&(h+=360*parseInt((Math.abs(h)+360)/360)),h%=360;var rgb,c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2;h<60?rgb=[c,x,0]:h<120?rgb=[x,c,0]:h<180?rgb=[0,c,x]:h<240?rgb=[0,x,c]:h<300?rgb=[x,0,c]:h<360&&(rgb=[c,0,x]);var result=[Math.round(255*(rgb[0]+m)),Math.round(255*(rgb[1]+m)),Math.round(255*(rgb[2]+m))];return hsl.length>3&&(result[3]=hsl[3]),result}};!function(){function animateFunction(time,frame){var cssText=frame.getCSSText(),element=this.element;if(element)if(element instanceof NodeList)for(var length=element.length,i=0;i<length;++i)element[i].style.cssText=cssText;else element.style.cssText=cssText}Frame._defaultProperties={translate:"0, 0",opacity:1,scale:"1, 1",rotateY:"0deg",rotateX:"0deg",rotateZ:"0deg",rotate:"0deg",blur:"0px",grayscale:"0%",contrast:"0%",brightness:"0%",invert:"0%",saturate:"0%",sepia:"0%"};Scene.addRole("property","properties"),Scene.addRole("transform","transforms"),Scene.addRole("filter","filters"),defineGetterSetter(sceneItemPrototype,"selector"),defineGetterSetter(sceneItemPrototype,"element"),scenePrototype.setSelector=function(selectors,itemName){var item;if("string"==typeof selectors)return(item=this.getItem(itemName))?(item.setSelector(selectors),this):this;for(selector in selectors)itemName=selectors[selector],item=this.getItem(itemName),item&&item.setSelector(selector);return this},sceneItemPrototype.setSelector=function(selector){return this.selector=selector,this.element=document.querySelectorAll(selector),this},scenePrototype._addElement=function(elements){var i,length=elements.length,arr=[];for(i=0;i<length;++i)arr[i]=this.addElement(elements[i]);return arr},scenePrototype.addElement=function(id,element){var length=arguments.length;if(0!==length){if(1===length){element=id,id="";var type=typeof element;if(!element)return;if("string"===type)return this._addElement(document.querySelectorAll(element));if(element instanceof Array||element instanceof NodeList)return this._addElement(element)}_id=element.getAttribute(ATTR_ITEM_ID),_id?id||(id=_id):(id=id?id:"item"+parseInt(1e4*Math.random()),element.setAttribute(ATTR_ITEM_ID,id));var item=new SceneItem(element);return this.addItem(id,item)}},sceneItemPrototype.init=function(){this.element&&(this.element.setAttribute("role","item"),this.addStyleToFrame(Scene.DEFAULT_FRAME_TIME)),this.on("animate",animateFunction)},sceneItemPrototype.addCSSToFrame=function(time,property){var element=this.element;if(element instanceof NodeList&&(element=element[0]),!element)return this;var css=element.style[property];"undefined"!=typeof css&&""!==css||(css=getComputedStyle(element)[property]);var frame=this.newFrame(time),value={};return value[property]=css,frame.load(value),this},sceneItemPrototype.addStyleToFrame=function(time){var element=this.element;if(element instanceof NodeList&&(element=element[0]),!element)return this;for(var a2,value,cssText=element.style.cssText,a1=cssText.split(";"),l=a1.length,cssObject={},i=0;i<l;++i)a2=a1[i].split(":"),a2.length<=1||(value=a2[1].trim(),cssObject[a2[0].trim()]=value);return this.setProperties(time,cssObject),this},scenePrototype.playCSS=function(){if(this.isStart)return this;this.startTime=this.prevTime=Date.now(),this.nowTime=this.spendTime=0,this.setPlayCount(0),this.isStart=!0,this.isFinish=!1,this.isPause=!1;var item,selector,elements,i,length,sceneItems=this.sceneItems;for(var id in sceneItems)for(item=sceneItems[id],selector=item.getSelector(),elements=document.querySelectorAll(selector),length=elements.length,i=0;i<length;++i)elements[i].className+=" startAnimation";return this},scenePrototype.stopCSS=function(){console.log("STOP"),this.isStart=!1,this.isFinish=!0,this.isPause=!1;var item,selector,elements,i,length,sceneItems=this.sceneItems;for(var id in sceneItems)for(item=sceneItems[id],selector=item.getSelector(),elements=document.querySelectorAll(selector),length=elements.length,i=0;i<length;++i)elements[i].className=replaceAll(elements[i].className,"startAnimation","");return this},scenePrototype.exportCSS=function(){var sceneItem,sceneItems=this.sceneItems,finishTime=this.getFinishTime(),count=this.getIterationCount();css="";for(var id in sceneItems)sceneItem=sceneItems[id],css+=sceneItem.setFrameToCSSRule(finishTime,count);var style="<style>"+css+"</style>";return document.head.insertAdjacentHTML("afterbegin",style),this};var CSS_ANIMATION_START_RULE="{selector}.startAnimation{{prefix}animation: scenejs_animation_{id} {time}s {type};{prefix}animation-fill-mode: forwards;{prefix}animation-iteration-count:{count};}";sceneItemPrototype.exportCSSRule=function(finishTime,count){if(!this.getSelector())return"";var selectors=this.getSelector().split(","),length=selectors.length;finishTime=finishTime||this.getFinishTime(),count=count||1;var css="",id=this.selector.match(/[0-9a-zA-Z]+/g).join("")+this.id,_CSS_ANIMATION_START_RULE=replaceAll(CSS_ANIMATION_START_RULE,"{prefix}","");_CSS_ANIMATION_START_RULE=replaceAll(_CSS_ANIMATION_START_RULE,"{time}",finishTime),_CSS_ANIMATION_START_RULE=replaceAll(_CSS_ANIMATION_START_RULE,"{type}","linear"),_CSS_ANIMATION_START_RULE=replaceAll(_CSS_ANIMATION_START_RULE,"{count}",count),_CSS_ANIMATION_START_RULE=replaceAll(_CSS_ANIMATION_START_RULE,"{id}",id);for(var i=0;i<length;++i)css+=replaceAll(_CSS_ANIMATION_START_RULE,"{selector}",selectors[i]);var time,keyframeCss="@keyframes scenejs_animation_"+id+"{",times=this.times;legnth=times.length;for(var percentage,i=0;i<legnth;++i)time=times[i],percentage=time/finishTime*100+"% ",keyframeCss+=percentage+"{"+this.getNowFrame(time).getCSSText()+"}\n";return keyframeCss+="}\n",css+=keyframeCss},framePrototype.getCSSObject=function(){var value,transforms=this.properties.transform,filters=this.properties.filter,properties=this.properties.property,cssObject={},cssTransform="",cssFilter="";for(var transformName in transforms){value=transforms[transformName];try{if(value instanceof Object&&(value=value.toValue()),"undefined"==typeof value)continue;cssTransform+=transformName+"("+value+")",cssTransform+=" "}catch(e){}}cssTransform&&(cssObject.transform=cssTransform);for(var filterName in filters){value=filters[filterName];try{if(value instanceof Object&&(value=value.toValue()),"undefined"==typeof value)continue;cssFilter+=filterName+"("+value+")",cssFilter+=" "}catch(e){}}cssFilter&&(cssObject.filter=cssFilter);for(var propertyName in properties){value=properties[propertyName];try{if(value instanceof Object&&(value=value.toValue()),"undefined"==typeof value)continue;cssObject[propertyName]=value}catch(e){}}return cssObject};var convertCrossBrowserCSSObject=function(cssObject,property){cssObject["-moz-"+property]=cssObject["-ms-"+property]=cssObject["-o-"+property]=cssObject["-webkit-"+property]=cssObject[property];
};framePrototype.getCSSText=function(){var property,cssObject=this.getCSSObject(),cssText="";cssObject.transform&&convertCrossBrowserCSSObject(cssObject,"transform"),cssObject.filter&&convertCrossBrowserCSSObject(cssObject,"filter");for(property in cssObject)cssText+=property+":"+cssObject[property]+";";return cssText}}()}();